# 【PC管理者承認済み】MKG改善活動システム 技術仕様・セキュリティ・コスト報告書

**承認状況:** ✅ ユーザー承認済み（2025-09-10）  
**制約適用:** 本仕様書の内容を開発制約として厳守

---

## 📋 システム概要
**システム名:** MKG改善活動管理システム  
**目的:** 社内改善活動（5S活動・カイゼン計画）の管理・追跡  
**対象利用者:** 社内の各チーム（最大6チーム想定）  
**開発状況:** 基本機能実装完了・テスト稼働中

---

## 🔧 技術構成

### フロントエンド
- **Next.js 14.2.32** - Meta社開発のReactベースWebフレームワーク
- **React 18.3.1** - Meta社開発のユーザーインターフェースライブラリ
- **実行環境:** ローカル開発サーバー（localhost:3000）

### バックエンド・データベース
- **Supabase** - PostgreSQLベースのクラウドデータベースサービス
- **認証方式:** Supabase Auth（メール＋パスワード認証）
- **セキュリティ:** Row Level Security (RLS) 実装済み

### 依存ライブラリ
- `@supabase/supabase-js` - データベース接続ライブラリ
- `html2canvas`, `jspdf` - 報告書PDF出力用（オフライン動作）

---

## 🛡️ セキュリティ設定

### データアクセス制御
✅ **Row Level Security (RLS)** により、チーム別データ分離実装  
✅ **認証必須** - 未認証ユーザーはアクセス不可  
✅ **チーム権限管理** - ユーザーは所属チームのデータのみ操作可能  
✅ **パスワード暗号化** - Supabase標準暗号化（bcrypt）

### ネットワーク・通信
✅ **HTTPS強制** - すべての通信が暗号化  
✅ **API制限** - 認証済みユーザーのみAPI使用可能  
✅ **CORS設定** - 指定ドメインからのみアクセス許可

### データ保護
✅ **個人情報最小化** - ユーザー名・チーム情報のみ保存
✅ **業務データ限定** - 改善計画・チェックシート等の業務データのみ
✅ **データ暗号化** - Supabase標準暗号化（AES-256）
✅ **ローカル環境依存ゼロ** - localStorage/sessionStorage使用禁止、全データSupabase統一
✅ **マルチデバイス対応** - PC・スマホ・タブレット間でのデータ同期保証

---

## 💰 コスト・制限事項（開発制約）

### Supabase 無料枠利用 - 絶対遵守事項
| 項目 | 制限値 | 現在使用量 | 制約レベル |
|------|--------|------------|------------|
| **データベース容量** | 500MB | < 10MB | 🔴 絶対制限 |
| **月間アクティブユーザー** | 10,000人 | < 100人 | 🔴 絶対制限 |
| **帯域幅** | 10GB/月 | < 1GB/月 | 🔴 絶対制限 |
| **ファイルストレージ** | 1GB | 0MB | 🔴 絶対制限 |

### 制限時の動作（開発考慮事項）
⚠️ **容量超過時:** データベースが読み取り専用に自動切り替え（新規追加停止、データ消失なし）  
⚠️ **ユーザー数超過時:** 新規登録が一時停止（既存ユーザーは継続使用可能）  
💡 **開発義務:** 使用量監視機能により事前警告・対応を実装必須

---

## 🌐 外部依存・ネットワーク要件

### 必要な外部接続（承認済み）
✅ **Supabase API** (https://xrwpzdvftrqaowjrtrrz.supabase.co)  
- 用途：データベース操作・ユーザー認証  
- 通信：HTTPS暗号化  
- データ：業務データのみ（個人情報最小限）

### ローカル環境
✅ **開発サーバー:** localhost:3000（社内ネットワークのみ）  
✅ **Node.js** - JavaScript実行環境  
✅ **ブラウザ要件** - Chrome, Firefox, Safari, Edge (現行版)

---

## 📊 実装済み機能

### 認証・アクセス管理
✅ ユーザー新規登録・ログイン機能  
✅ チーム選択機能（6チーム対応）  
✅ チーム別アクセス制御

### 業務機能
✅ カイゼン計画作成・編集・管理  
✅ タスク管理（計画中/進行中/完了）  
✅ 活動報告書作成・PDF出力  
✅ パトロールチェックシート（5S項目）

---

## 🚨 開発制約・遵守事項

### 絶対制約事項
🔴 **無料枠制限の厳守** - 制限値を超える機能実装禁止  
🔴 **外部依存の限定** - Supabase以外のクラウドサービス使用禁止  
🔴 **セキュリティ基準の維持** - RLS・暗号化の維持必須  
🔴 **データ最小化の原則** - 不要なデータ保存禁止

### 監視必須項目
- データベース使用量（月次確認）
- アクティブユーザー数（月次確認）  
- エラーログ監視（週次確認）
- 制限値接近時の早期警告実装

---

## ✅ PC管理者承認事項

承認済み事項：
1. ✅ **技術構成の妥当性** - 使用技術・ライブラリの安全性
2. ✅ **セキュリティ対策の十分性** - 社内情報保護への配慮
3. ✅ **コスト制限の適切性** - 無料枠での安全な運用
4. ✅ **外部依存の許可** - Supabaseサービスへの接続許可
5. ✅ **運用・保守体制の確認** - 継続的な安全運用への配慮

**承認日:** 2025年9月10日  
**開発制約適用日:** 2025年9月10日  
**次回見直し予定:** 無料枠制限接近時または6ヶ月後

---

## 🚀 今後の開発方針

本仕様書の制約内で以下の開発を継続：
1. **チーム協力機能の実装**（無料枠内）
2. **既存機能の最適化**（パフォーマンス向上）
3. **使用量監視機能の実装**（制限管理）

**重要:** すべての開発は本仕様書の制約を遵守し、無料枠を超えない範囲で実施する。